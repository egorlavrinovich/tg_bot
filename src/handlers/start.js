import { findUserByTelegramId, setUserState } from "../models/User.js";

export async function handleStart(bot, msg) {
  const telegramId = msg.from.id;
  const user = await findUserByTelegramId(telegramId);

  if (user?.state === "WAITING_CONFIRM") {
    return bot.sendMessage(
      msg?.chat?.id || msg?.message?.chat?.id,
      "–£ –≤–∞—Å –æ—Ç–∫—Ä—ã—Ç–∞ –∑–∞—è–≤–∫–∞, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É"
    );
  }

  await setUserState(telegramId, "ROLE_SELECT");

  await bot.sendMessage(
    msg?.chat?.id || msg?.message?.chat?.id,
    "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –†–∞–±–æ—Ç–∞–†—è–¥–æ–º–ë—Ä–µ—Å—Ç! \n\n –≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç—É –≤ –ë—Ä–µ—Å—Ç–µ. \n\n üîπ –ù—É–∂–µ–Ω –º–∞—Å—Ç–µ—Ä, –≥—Ä—É–∑—á–∏–∫ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–∞? \n\n üîπ –ò—â–µ—Ç–µ —Ä–∞–±–æ—Ç—É –∏–ª–∏ –∑–∞–∫–∞–∑—ã —Ä—è–¥–æ–º? \n\n –ó–∞—è–≤–∫–∞ —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞–µ—Ç –∫ –∂–∏–≤—ã–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º –±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤, –∑–≤–æ–Ω–∫–æ–≤ –∏ —Å–∞–π—Ç–æ–≤. \n\n –í—ã —Å–∞–º–∏ –≤—ã–±–∏—Ä–∞–µ—Ç–µ, —Å –∫–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å: –∑–∞–∫–∞–∑—ã –∏ —É—Å–ª—É–≥–∏ –¥–ª—è –∂–∏—Ç–µ–ª–µ–π –ë—Ä–µ—Å—Ç–∞, —Ä–µ–º–æ–Ω—Ç, –ø–µ—Ä–µ–≤–æ–∑–∫–∏, –±—ã—Ç–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã, –ø–æ–º–æ—â—å ¬´–º—É–∂ –Ω–∞ —á–∞—Å¬ª –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. \n\n üëá –í—ã–±–µ—Ä–∏—Ç–µ, –∫—Ç–æ –≤—ã:",
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: "üîç –ò—â—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞", callback_data: "role_client" }],
          [{ text: "üßë‚Äçüíº –Ø —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", callback_data: "role_specialist" }],
        ],
      },
    }
  );
}
